# three.js 群衆シミュレーション開発ステップガイド

このドキュメントは、three.jsでXの投稿のような群衆シミュレーションを作成するための開発ステップをまとめたものです。

## ステップ1: 静的なスプライトを大量に表示する

- [ ] three.jsの基本シーン（シーン、カメラ、レンダラー）をセットアップする。
- [ ] `PlaneGeometry` と `MeshBasicMaterial` で単一のスプライトを作成する。
- [ ] `InstancedMesh` を使って、スプライトを画面上に大量に（例: 1000個）配置する。
- [ ] 各インスタンスの位置をランダムに設定する。

## ステップ2: 個別にアニメーションさせる

- [ ] キャラクターのスプライトシート画像を用意する。
- [ ] `ShaderMaterial` を作成し、カスタムのVertex ShaderとFragment Shaderを記述する準備をする。
- [ ] Fragment ShaderでスプライトシートのUV座標を計算し、特定フレームを切り出して表示するロジックを実装する。
- [ ] `uniform` 変数を使って、時間 (`time`) をシェーダーに渡し、アニメーションさせる。
- [ ] `InstancedBufferAttribute` を使って、各インスタンスのアニメーション開始タイミングにオフセットを与え、動きをバラバラにする。

## ステップ3: マウスで動かせるようにする

- [ ] JavaScript側で、各インスタンスの状態（位置、速度、目標座標）を管理する配列を用意する。
- [ ] `requestAnimationFrame` のループ内で、各インスタンスの次のフレームの位置を計算するロジック（シミュレーション）を実装する。
- [ ] マウスイベントを検知し、マウスカーソルの位置を3D空間上の目標座標に変換する。
- [ ] 全インスタンスが目標座標に向かって移動するように、シミュレーションロジックを更新する。
- [ ] 計算した各インスタンスの位置を行列 (`Matrix4`) に変換し、`InstancedMesh.setMatrixAt()` で毎フレーム更新する。
